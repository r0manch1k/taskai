# taskai

Телеграм Бот для создания и организации задач в [Kaiten](https://kaiten.ru/features/) при помощи ИИ

Шаблон для Symfony + Docker взят [отсюда](https://github.com/dunglas/symfony-docker?tab=readme-ov-file).

## Разработка

```
make start
```

Проверить можно на `http://localhost`

### Телеграм Бот

```
make webhook
```

Обращаю внимание на то, что используемый в шаблоне сервер _Caddy_ перенаправляет все запросы на _SERVER_NAME_ с HTTP на HTTPS (хоть его и не просили). Это ломает систему туннелинга при тестировании Телеграм Бота через вебхук. Поэтому рекомендую удостовериться, что следующие переменные в `.env` установлены именно таким образом:

```sh
SERVER_NAME='http://'
HTTP_PORT=8079 # можно и 80, но он редиректит на 443
```

В качестве постоянного хранилища данных используется PostgreSQL, так как в Symfony + Doctrine приложениях оно является наиболее популярным выбором, а следовательно, наиболее документируемым и поддерживаемым. Для настройки используются переменные окружения

```sh
POSTGRES_DB='taskai'
POSTGRES_USER='db_user'
POSTGRES_PASSWORD='db_password'
POSTGRES_PORT='5432'
```

В качестве оперативного хранилища для сессий при работе Телеграм Бота используется Redis из-за несложности его настройки и наличия приятных возможностей и встроенных инструментов. Для настройки используется файл `redis/redis.conf` и переменные окружения

```
REDIS_PORT='6379'
REDIS_PASSWORD='redis_pass'
REDIS_URL=redis://${REDIS_PASSWORD}@redis:6379
```

В качетсве брокера сообщений для создания задач с использованием ИИ Агента используется RabbitMQ. Для настройки используются переменные окружения

```
RABBITMQ_HOST='rabbitmq'
RABBITMQ_PORT='5672'
RABBITMQ_USER='guest'
RABBITMQ_PASSWORD='guest'
```

Веб-интерфейс доступен на http://localhost:5672/

Для удобного взаимодействия с Doctrine в `Makefile` есть основные команды. Для работы базы данных необходимо выполнить

```
make doctrine-create
make doctrine-migrate
```

### Линтинг и форматирование

```
make csfix
make psalm
```
